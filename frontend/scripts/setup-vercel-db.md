# Vercel Database Setup Guide

## Quick Setup with Supabase (Recommended)

### Step 1: Create Supabase Project
1. Go to https://supabase.com
2. Sign up/Login
3. Click "New Project"
4. Choose organization
5. Enter project name: `lumpsum-preview`
6. Enter database password (save this!)
7. Choose region (closest to your users)
8. Click "Create new project"

### Step 2: Get Connection String
1. In Supabase Dashboard, go to Settings > Database
2. Copy the "Connection string" (URI format)
3. It looks like: `postgresql://postgres:[password]@db.[project-ref].supabase.co:5432/postgres`

### Step 3: Add to Vercel Environment Variables
1. Go to your Vercel project dashboard
2. Navigate to Settings > Environment Variables
3. Add the following variables:

```
DATABASE_URL=postgresql://postgres:[your-password]@db.[project-ref].supabase.co:5432/postgres
NEXTAUTH_URL=https://your-preview-url.vercel.app
NEXTAUTH_SECRET=your-secret-key
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
RECAPTCHA_SECRET_KEY=your-recaptcha-secret
NEXT_PUBLIC_RECAPTCHA_SITE_KEY=your-recaptcha-site-key
```

### Step 4: Run Database Migrations
1. In Supabase Dashboard, go to SQL Editor
2. Run the Prisma schema migration:

```sql
-- Create the database tables based on your Prisma schema
-- This will be generated by Prisma when you run: npx prisma db push
```

### Step 5: Deploy and Test
1. Push your changes to GitHub
2. Vercel will automatically deploy
3. Test the feedback form and other database features

## Alternative: Vercel Postgres

### Step 1: Create Vercel Postgres Database
1. In Vercel Dashboard, go to Storage tab
2. Click "Create Database"
3. Select "Postgres"
4. Choose Hobby plan (free)
5. Select region
6. Click "Create"

### Step 2: Environment Variables
Vercel will automatically add:
- `POSTGRES_URL`
- `POSTGRES_PRISMA_URL`
- `POSTGRES_URL_NON_POOLING`
- `POSTGRES_USER`
- `POSTGRES_HOST`
- `POSTGRES_PASSWORD`
- `POSTGRES_DATABASE`

### Step 3: Update Prisma Configuration
Update your `DATABASE_URL` to use:
```
DATABASE_URL=${POSTGRES_PRISMA_URL}
```

## Testing Database Connection

### Health Check
Visit: `https://your-preview-url.vercel.app/api/health`

### Feedback Form
Visit: `https://your-preview-url.vercel.app/feedback`

### Database Status
Check Vercel logs for any database connection errors.

## Troubleshooting

### Common Issues:
1. **Connection Timeout**: Check if database is in same region
2. **Authentication Error**: Verify connection string format
3. **SSL Issues**: Add `?sslmode=require` to connection string
4. **Migration Errors**: Run `npx prisma db push` locally first

### Debug Commands:
```bash
# Test connection locally
npx prisma db push

# Generate Prisma client
npx prisma generate

# Check database status
npx prisma studio
```

## Environment Variables Checklist

Make sure these are set in Vercel:
- [ ] `DATABASE_URL`
- [ ] `NEXTAUTH_URL`
- [ ] `NEXTAUTH_SECRET`
- [ ] `GOOGLE_CLIENT_ID`
- [ ] `GOOGLE_CLIENT_SECRET`
- [ ] `RECAPTCHA_SECRET_KEY`
- [ ] `NEXT_PUBLIC_RECAPTCHA_SITE_KEY`
